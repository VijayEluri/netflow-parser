<?xml version="1.0"?>
<project name="newflow" basedir="." default="dist">
	<property name="base.dir" value="."/>
	<property name="source.dir" value="${base.dir}/src"/>
	<property name="lib.dir" value="${base.dir}/lib"/>
	<property name="build.dir" value="${base.dir}/build"/>
	<property name="dist.dir" value="${base.dir}/dist"/>
	<property name="project.name" value="netflow"/>
	<path id="compile.path">
		<fileset dir="${lib.dir}">
			<include name="*.jar"/>
		</fileset>
	</path>
	<path id="run.path">
		<fileset dir="${lib.dir}">
			<include name="*.jar"/>
		</fileset>
		<fileset dir="${dist.dir}">
			<include name="*.jar"/>
		</fileset>
	</path>
	<target name="clean">
		<delete dir="${build.dir}"/>
		<delete dir="${dist.dir}"/>
	</target>
	<target name="prepare" depends="clean">
		<mkdir dir="${build.dir}"/>
		<mkdir dir="${dist.dir}"/>
	</target>
	<target name="build" depends="prepare">
		<javac destdir="${build.dir}" srcdir="${source.dir}" debug="true">
			<classpath refid="compile.path"></classpath>
		</javac>
	</target>
	<target name="create-manifest" depends="prepare">
		<manifest file="${build.dir}/MANIFEST.MF">
			<attribute name="Main-Class" value="netflow.Main"/>
            <attribute name="Class-Path" value="postgresql-8.1-405.jdbc3.jar commons-logging.jar log4j-1.2.8.jar"/>
		</manifest>
	</target>
	<target name="dist" depends="build, create-manifest">
		<jar destfile="${dist.dir}/${project.name}.jar"
			manifest="${build.dir}/MANIFEST.MF">
			<fileset dir="${build.dir}">
				<include name="**/*.class"/>
			</fileset>
			<fileset dir="${source.dir}">
				<include name="**/*.properties"/>
				<include name="**/*.jpg"/>
			</fileset>
		</jar>
		<copy todir="${dist.dir}">
			<fileset dir="${base.dir}">
				<include name="*.properties"/>
			</fileset>
		</copy>
		<copy todir="${dist.dir}">
			<fileset dir="${lib.dir}">
				<include name="*.jar"/>
			</fileset>
		</copy>
	</target>
	<target name="run" depends="dist">
		<java classpathref="run.path" classname="webcam.Main" fork="true">
			<jvmarg value="-Dlog4.configuration=file:///home/slava/log4.properties"/>
			<jvmarg value="-server"/>
		</java>
	</target>
</project>
